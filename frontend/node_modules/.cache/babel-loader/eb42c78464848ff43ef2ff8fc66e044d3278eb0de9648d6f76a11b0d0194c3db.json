{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState, useCallback } from 'react';\nimport { createWebSocket } from '../utils/api';\nexport const useWebSocket = scanId => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastMessage, setLastMessage] = useState(null);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectAttemptRef = useRef(0);\n  const maxReconnectAttempts = 5;\n  const connect = useCallback(() => {\n    var _wsRef$current;\n    if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n      return;\n    }\n    try {\n      const ws = createWebSocket(scanId);\n      wsRef.current = ws;\n      ws.onopen = () => {\n        setIsConnected(true);\n        setError(null);\n        reconnectAttemptRef.current = 0;\n        console.log('WebSocket connected');\n      };\n      ws.onmessage = event => {\n        try {\n          const data = JSON.parse(event.data);\n          setLastMessage(data);\n        } catch (err) {\n          console.error('Failed to parse WebSocket message:', err);\n        }\n      };\n      ws.onerror = error => {\n        console.error('WebSocket error:', error);\n        setError('WebSocket connection error');\n      };\n      ws.onclose = event => {\n        setIsConnected(false);\n        console.log('WebSocket disconnected:', event.code, event.reason);\n\n        // Attempt reconnection\n        if (reconnectAttemptRef.current < maxReconnectAttempts) {\n          reconnectAttemptRef.current += 1;\n          const delay = Math.min(1000 * reconnectAttemptRef.current, 5000);\n          console.log(`Reconnecting in ${delay}ms...`);\n          setTimeout(() => {\n            if (scanId) {\n              connect();\n            }\n          }, delay);\n        }\n      };\n    } catch (err) {\n      setError('Failed to create WebSocket connection');\n      console.error('WebSocket creation error:', err);\n    }\n  }, [scanId]);\n  const disconnect = useCallback(() => {\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n  }, []);\n  const sendMessage = useCallback(message => {\n    var _wsRef$current2;\n    if (((_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.readyState) === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n      return true;\n    }\n    return false;\n  }, []);\n  useEffect(() => {\n    if (scanId) {\n      connect();\n    }\n    return () => {\n      disconnect();\n    };\n  }, [scanId, connect, disconnect]);\n  return {\n    isConnected,\n    lastMessage,\n    error,\n    sendMessage,\n    disconnect,\n    connect\n  };\n};\n_s(useWebSocket, \"pQ5pqTPT7T1BHFZD6LiqnxokIZY=\");","map":{"version":3,"names":["useEffect","useRef","useState","useCallback","createWebSocket","useWebSocket","scanId","_s","isConnected","setIsConnected","lastMessage","setLastMessage","error","setError","wsRef","reconnectAttemptRef","maxReconnectAttempts","connect","_wsRef$current","current","readyState","WebSocket","OPEN","ws","onopen","console","log","onmessage","event","data","JSON","parse","err","onerror","onclose","code","reason","delay","Math","min","setTimeout","disconnect","close","sendMessage","message","_wsRef$current2","send","stringify"],"sources":["D:/vuln-scanner/frontend/src/hooks/useWebSocket.ts"],"sourcesContent":["import { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { createWebSocket } from '../utils/api';\r\nimport { WebSocketMessage } from '../types';\r\n\r\nexport const useWebSocket = (scanId: string) => {\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  const wsRef = useRef<WebSocket | null>(null);\r\n  const reconnectAttemptRef = useRef(0);\r\n  const maxReconnectAttempts = 5;\r\n\r\n  const connect = useCallback(() => {\r\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const ws = createWebSocket(scanId);\r\n      wsRef.current = ws;\r\n\r\n      ws.onopen = () => {\r\n        setIsConnected(true);\r\n        setError(null);\r\n        reconnectAttemptRef.current = 0;\r\n        console.log('WebSocket connected');\r\n      };\r\n\r\n      ws.onmessage = (event) => {\r\n        try {\r\n          const data: WebSocketMessage = JSON.parse(event.data);\r\n          setLastMessage(data);\r\n        } catch (err) {\r\n          console.error('Failed to parse WebSocket message:', err);\r\n        }\r\n      };\r\n\r\n      ws.onerror = (error) => {\r\n        console.error('WebSocket error:', error);\r\n        setError('WebSocket connection error');\r\n      };\r\n\r\n      ws.onclose = (event) => {\r\n        setIsConnected(false);\r\n        console.log('WebSocket disconnected:', event.code, event.reason);\r\n\r\n        // Attempt reconnection\r\n        if (reconnectAttemptRef.current < maxReconnectAttempts) {\r\n          reconnectAttemptRef.current += 1;\r\n          const delay = Math.min(1000 * reconnectAttemptRef.current, 5000);\r\n          \r\n          console.log(`Reconnecting in ${delay}ms...`);\r\n          setTimeout(() => {\r\n            if (scanId) {\r\n              connect();\r\n            }\r\n          }, delay);\r\n        }\r\n      };\r\n    } catch (err) {\r\n      setError('Failed to create WebSocket connection');\r\n      console.error('WebSocket creation error:', err);\r\n    }\r\n  }, [scanId]);\r\n\r\n  const disconnect = useCallback(() => {\r\n    if (wsRef.current) {\r\n      wsRef.current.close();\r\n      wsRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const sendMessage = useCallback((message: any) => {\r\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n      wsRef.current.send(JSON.stringify(message));\r\n      return true;\r\n    }\r\n    return false;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (scanId) {\r\n      connect();\r\n    }\r\n\r\n    return () => {\r\n      disconnect();\r\n    };\r\n  }, [scanId, connect, disconnect]);\r\n\r\n  return {\r\n    isConnected,\r\n    lastMessage,\r\n    error,\r\n    sendMessage,\r\n    disconnect,\r\n    connect,\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}